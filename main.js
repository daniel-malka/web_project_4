!function(){"use strict";class e{constructor(e,t,s,r,i,n){var o,a;a=()=>this._cardElement.remove(),(o="removeCard")in this?Object.defineProperty(this,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[o]=a,this._name=e.name,this._userId=t,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._id=e._id,this._handleCardClick=r,this._handleLikeButton=i,this.handleDeleteCard=n,this._alt="Photo of ".concat(e.name),this._templateElement=s}getOwner(){console.log(this._owner)}isLiked(){return this._likes.some((e=>e._id==this._userId))}_handleDelete(e){this.handleDeleteCard(e)}getId(){return this._id}_setEventListeners(){this._deleteCard.addEventListener("click",(()=>this._handleDelete(this._id))),this._likeCard.addEventListener("click",(()=>this._handleLikeButton(this._id))),this._galleryImg.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))}addLike(){this._likeCard.classList.add("button_liked")}removeLike(){this._likeCard.classList.remove("button_liked")}setLikes(e){this._likes=e,this.likesAmount=this._likes.length,this._likesCounter.textContent=this.likesAmount}createCard(){return this._cardElement=document.querySelector(this._templateElement).content.querySelector(".gallery__item").cloneNode(!0),this._galleryImg=this._cardElement.querySelector(".gallery__img"),this._galleryText=this._cardElement.querySelector(".desc__text"),this._deleteCard=this._cardElement.querySelector(".gallery__bin"),this._likeCard=this._cardElement.querySelector(".like__button"),this._likesCounter=this._cardElement.querySelector(".like__counter"),this._galleryText.textContent=this._name,this._galleryImg.src=this._link,this._galleryImg.alt=this._alt,this.setLikes(this._likes),this._setEventListeners(),this.isLiked()?this.addLike():this.removeLike(),this._cardElement}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s){t(this,"resetValidation",(()=>{this._hideAllErrors(),this._formElement.reset(),this._disableButton()})),t(this,"enableValidation",(()=>{this._formElement.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()})),t(this,"_setEventListeners",(()=>{this._allInputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton(this._allInputs)}))}))})),t(this,"_hideAllErrors",(()=>{this._allInputs.forEach((e=>{this._hideInputError(e)}))})),t(this,"_disableButton",(()=>{const{buttonDisable:e}=this._settings;this._buttonEl.classList.add(e),this._buttonEl.disabled=!0})),t(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,spanErrorClass:r}=this._settings;this._errorDynamicSpan=this._formElement.querySelector(".fieldset__error-type-".concat(e.id)),e.classList.add(s),this._errorDynamicSpan.textContent=t,this._errorDynamicSpan.classList.add(r)})),t(this,"_hideInputError",(e=>{const{inputErrorClass:t,spanErrorClass:s}=this._settings;this._errorDynamicSpan=this._formElement.querySelector(".fieldset__error-type-".concat(e.id)),e.classList.remove(t),this._errorDynamicSpan.classList.remove(s),this._errorDynamicSpan.textContent=""})),t(this,"_toggleButton",(e=>{const{buttonDisable:t}=this._settings;e.every((e=>e.validity.valid))?(this._buttonEl.classList.remove(t),this._buttonEl.disabled=!1):this._disableButton()})),t(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),this._settings=e,this._formElement=s,this._allInputs=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonEl=this._formElement.querySelector(this._settings.buttonSelector)}}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e){r(this,"_handleOverlay",(e=>{e.target.classList.contains("popup")&&this.close()})),r(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",this._handleOverlay),this._popup.querySelector(".popup__close").addEventListener("mousedown",(()=>this.close()))}}class n extends i{constructor(e,t){super(e),this._handleForm=t,this._form=this._popup.querySelector(".form"),this._inputs=Array.from(this._form.querySelectorAll(".fieldset__input"))}_getInputValues(){return this._values={},this._inputs.forEach((e=>{this._key=e.name,this._value=e.value,this._values[this._key]=this._value})),this._values}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._valuesFromForm=this._getInputValues(),this._handleForm(this._valuesFromForm),super.close()}))}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._form.reset()}}const o=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject(e.statusText))).catch((e=>{console.log(e)})),a=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}getCards(){return o(this._baseUrl+"/cards",{headers:this._headers})}getUserInfo(){return o(this._baseUrl+"/users/me",{headers:this._headers})}setUserInfo(e){let{name:t,about:s}=e;return o(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:s})})}addCard(e){let{name:t,link:s}=e;return o(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:s})})}deleteCard(e){return o("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}dislikeCard(e){return o("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"})}likeCard(e){return o("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"6efb715f-3f27-47aa-b11b-00d476bb80a2","Content-Type":"application/json"}}),l=".gallery",h=document.forms.formProfile.elements.name,_=document.forms.formProfile.elements.about,d=document.querySelector(".text__edit"),c=document.querySelector(".top__plus-box"),u={inputSelector:".fieldset__input",buttonSelector:".fieldset__button",buttonDisable:"fieldset__button_disabled",inputErrorClass:"fieldset__input_error",spanErrorClass:"fieldset__error-message-active"};let m;const p=new class extends i{setAction(e){this._submitHandler=e}setEventListeners(){this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(),super.close()}))}}(".popup_type_card-delete");p.setEventListeners();const b=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}renderInitialItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}((e=>{f(e)}),l),f=e=>{b.addItem(y(e))},E=new class{constructor(e){this._userName=document.querySelector(e.name),this._userAbout=document.querySelector(e.about)}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent}}setUserInfo(e){let{nameInput:t,aboutInput:s}=e;this._userName.textContent=t,this._userAbout.textContent=s}}({name:".text__name",about:".text__about"});Promise.all([a.getUserInfo(),a.getCards()]).then((e=>{let[t,s]=e;m=t._id,E.setUserInfo({nameInput:t.name,aboutInput:t.about}),b.renderInitialItems(s)})).catch(console.log);const y=t=>{const s=new e(t,m,"#gallery__item",((e,t)=>{k.open(e,t)}),(e=>{s.isLiked()?a.dislikeCard(e).then((e=>{s.setLikes(e.likes),s.removeLike()})):a.likeCard(e).then((e=>{s.setLikes(e.likes),s.addLike()})).catch(console.log())}),(e=>{p.open(),p.setAction((()=>a.deleteCard(e).then((e=>{console.log("1111",e),s.removeCard()}))))}));return s.createCard()},g=new n(".popup_type_card",(e=>{a.addCard({name:e.title,link:e.link}).then((e=>{f(e,l),g.close()})).catch(console.log)})),v={formImg:"formImg",formProfile:"formProfile"};Array.from(document.querySelectorAll(".form")).forEach((e=>{const t=new s(u,e),r=e.getAttribute("name");v[r]=t,t.enableValidation()}));const k=new class extends i{open(e,t){this._image=this._popup.querySelector(".popup__img"),this._caption=this._popup.querySelector(".popup__caption"),this._caption.textContent=e,this._image.src=t,this._image.alt="Photo of ".concat(e),super.open()}}(".popup_type_zoom");k.setEventListeners();const L=new n(".popup_type_profile",(e=>{a.setUserInfo({name:e.name,about:e.about}).then((e=>{console.log(e),E.setUserInfo({nameInput:e.name,aboutInput:e.about})})).catch((e=>console.log(e,"something went wrong.. =/"))).finally((()=>{L.close()}))}));L.setEventListeners(),g.setEventListeners(),c.addEventListener("click",(()=>(v[formImg.getAttribute("name")].resetValidation(),void g.open()))),d.addEventListener("click",(()=>{v[formProfile.getAttribute("name")].resetValidation(),E.getUserInfo(),(()=>{const{name:e,about:t}=E.getUserInfo();h.value=e,_.value=t})(),L.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlsaXRpZXMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgZGF0YSxcbiAgICB1c2VySWQsXG4gICAgc2VsZWN0b3IsXG4gICAgaGFuZGxlQ2FyZENsaWNrLFxuICAgIGhhbmRsZUxpa2VCdXR0b24sXG4gICAgaGFuZGxlRGVsZXRlQ2FyZFxuICApIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbiA9IGhhbmRsZUxpa2VCdXR0b247XG4gICAgdGhpcy5oYW5kbGVEZWxldGVDYXJkID0gaGFuZGxlRGVsZXRlQ2FyZDtcbiAgICB0aGlzLl9hbHQgPSBgUGhvdG8gb2YgJHtkYXRhLm5hbWV9YDtcbiAgICB0aGlzLl90ZW1wbGF0ZUVsZW1lbnQgPSBzZWxlY3RvcjtcbiAgfVxuICBnZXRPd25lcigpIHtcbiAgICBjb25zb2xlLmxvZyh0aGlzLl9vd25lcik7XG4gIH1cbiAgaXNMaWtlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT0gdGhpcy5fdXNlcklkKTtcbiAgfVxuICBfaGFuZGxlRGVsZXRlKGNhcmRJZCkge1xuICAgIHRoaXMuaGFuZGxlRGVsZXRlQ2FyZChjYXJkSWQpO1xuICB9XG4gIGdldElkKCkge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuICByZW1vdmVDYXJkID0gKCkgPT4gdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2RlbGV0ZUNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGUodGhpcy5faWQpXG4gICAgKTtcbiAgICB0aGlzLl9saWtlQ2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24odGhpcy5faWQpXG4gICAgKTtcbiAgICB0aGlzLl9nYWxsZXJ5SW1nLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspXG4gICAgKTtcbiAgfVxuICBhZGRMaWtlKCkge1xuICAgIHRoaXMuX2xpa2VDYXJkLmNsYXNzTGlzdC5hZGQoXCJidXR0b25fbGlrZWRcIik7XG4gIH1cbiAgcmVtb3ZlTGlrZSgpIHtcbiAgICB0aGlzLl9saWtlQ2FyZC5jbGFzc0xpc3QucmVtb3ZlKFwiYnV0dG9uX2xpa2VkXCIpO1xuICB9XG5cbiAgc2V0TGlrZXMobmV3TGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IG5ld0xpa2VzO1xuICAgIHRoaXMubGlrZXNBbW91bnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XG4gICAgdGhpcy5fbGlrZXNDb3VudGVyLnRleHRDb250ZW50ID0gdGhpcy5saWtlc0Ftb3VudDtcbiAgfVxuXG4gIGNyZWF0ZUNhcmQoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fdGVtcGxhdGVFbGVtZW50KVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gICAgdGhpcy5fZ2FsbGVyeUltZyA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faW1nXCIpO1xuICAgIHRoaXMuX2dhbGxlcnlUZXh0ID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5kZXNjX190ZXh0XCIpO1xuICAgIHRoaXMuX2RlbGV0ZUNhcmQgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2JpblwiKTtcbiAgICB0aGlzLl9saWtlQ2FyZCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubGlrZV9fYnV0dG9uXCIpO1xuICAgIHRoaXMuX2xpa2VzQ291bnRlciA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubGlrZV9fY291bnRlclwiKTtcbiAgICB0aGlzLl9nYWxsZXJ5VGV4dC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fZ2FsbGVyeUltZy5zcmMgPSB0aGlzLl9saW5rO1xuXG4gICAgdGhpcy5fZ2FsbGVyeUltZy5hbHQgPSB0aGlzLl9hbHQ7XG4gICAgdGhpcy5zZXRMaWtlcyh0aGlzLl9saWtlcyk7XG5cbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIGlmICh0aGlzLmlzTGlrZWQoKSkge1xuICAgICAgdGhpcy5hZGRMaWtlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVtb3ZlTGlrZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2FsbElucHV0cyA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLl9idXR0b25FbCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zZXR0aW5ncy5idXR0b25TZWxlY3RvclxuICAgICk7XG4gIH1cbiAgcmVzZXRWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgIHRoaXMuX2hpZGVBbGxFcnJvcnMoKTtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5yZXNldCgpO1xuICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oKTtcbiAgfTtcbiAgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9O1xuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5fYWxsSW5wdXRzLmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b24odGhpcy5fYWxsSW5wdXRzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBfaGlkZUFsbEVycm9ycyA9ICgpID0+IHtcbiAgICB0aGlzLl9hbGxJbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9KTtcbiAgfTtcbiAgX2Rpc2FibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgY29uc3QgeyBidXR0b25EaXNhYmxlIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICB0aGlzLl9idXR0b25FbC5jbGFzc0xpc3QuYWRkKGJ1dHRvbkRpc2FibGUpO1xuICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgfTtcbiAgX3Nob3dJbnB1dEVycm9yID0gKGlucHV0RWwsIGVycm9yTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBzcGFuRXJyb3JDbGFzcyB9ID0gdGhpcy5fc2V0dGluZ3M7XG4gICAgdGhpcy5fZXJyb3JEeW5hbWljU3BhbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgLmZpZWxkc2V0X19lcnJvci10eXBlLSR7aW5wdXRFbC5pZH1gXG4gICAgKTtcbiAgICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoaW5wdXRFcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvckR5bmFtaWNTcGFuLnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIHRoaXMuX2Vycm9yRHluYW1pY1NwYW4uY2xhc3NMaXN0LmFkZChzcGFuRXJyb3JDbGFzcyk7XG4gIH07XG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsKSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIHNwYW5FcnJvckNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICB0aGlzLl9lcnJvckR5bmFtaWNTcGFuID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuZmllbGRzZXRfX2Vycm9yLXR5cGUtJHtpbnB1dEVsLmlkfWBcbiAgICApO1xuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yRHluYW1pY1NwYW4uY2xhc3NMaXN0LnJlbW92ZShzcGFuRXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3JEeW5hbWljU3Bhbi50ZXh0Q29udGVudCA9IFwiXCI7XG4gIH07XG4gIF90b2dnbGVCdXR0b24gPSAoaW5wdXRzKSA9PiB7XG4gICAgY29uc3QgeyBidXR0b25EaXNhYmxlIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICBjb25zdCBpc0lucHV0c1ZhbGlkID0gaW5wdXRzLmV2ZXJ5KChpbnB1dCkgPT4gaW5wdXQudmFsaWRpdHkudmFsaWQpO1xuXG4gICAgaWYgKGlzSW5wdXRzVmFsaWQpIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoYnV0dG9uRGlzYWJsZSk7XG4gICAgICB0aGlzLl9idXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKCk7XG4gICAgfVxuICB9O1xuICBfY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGlucHV0RWwpID0+IHtcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9XG4gIH07XG59XG4iLCJleHBvcnQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICB9XG4gIF9oYW5kbGVPdmVybGF5ID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwXCIpKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcbiAgb3BlbigpIHtcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlblwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5cIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlT3ZlcmxheSk7XG4gICAgdGhpcy5fcG9wdXBcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jbG9zZVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cFwiO1xuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm0pIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtID0gaGFuZGxlRm9ybTtcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuICAgIHRoaXMuX2lucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLmZpZWxkc2V0X19pbnB1dFwiKSk7XG4gIH1cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIHRoaXMuX3ZhbHVlcyA9IHt9O1xuXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICB0aGlzLl9rZXkgPSBpbnB1dC5uYW1lO1xuICAgICAgdGhpcy5fdmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgIHRoaXMuX3ZhbHVlc1t0aGlzLl9rZXldID0gdGhpcy5fdmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlcztcbiAgfVxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX3ZhbHVlc0Zyb21Gb3JtID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm0odGhpcy5fdmFsdWVzRnJvbUZvcm0pO1xuICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICB9KTtcbiAgfVxuICBzZXRJbnB1dFZhbHVlcyhkYXRhKSB7XG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dC52YWx1ZSA9IGRhdGFbaW5wdXQubmFtZV07XG4gICAgfSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpO1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgfVxufVxuIiwiY29uc3QgY3VzdG9tRmV0Y2ggPSAodXJsLCBoZWFkZXJzKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKHVybCwgaGVhZGVycylcclxuICAgIC50aGVuKChyZXMpID0+IChyZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MpIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBzZXR0aW5ncy5iYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IHNldHRpbmdzLmhlYWRlcnM7XHJcbiAgfVxyXG4gIGdldENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkc1wiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2godGhpcy5fYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2godGhpcy5fYmFzZVVybCArIGAvdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBhYm91dCxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG4gIH1cclxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGRpc2xpa2VDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgIH0pO1xyXG4gIH1cclxuICBsaWtlQ2FyZChpZCkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7aWR9YCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lblwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiNmVmYjcxNWYtM2YyNy00N2FhLWIxMWItMDBkNDc2YmI4MGEyXCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuIiwiY29uc3QgZ2FsbGVyeVdyYXAgPSAnLmdhbGxlcnknO1xuY29uc3QgYWRkQ2FyZFBvcHVwID0gJy5wb3B1cF90eXBlX2NhcmQnO1xuY29uc3QgcHJvZmlsZVBvcHVwID0gJy5wb3B1cF90eXBlX3Byb2ZpbGUnO1xuY29uc3Qgb3BlbkltZ1ZpZXcgPSAnLnBvcHVwX3R5cGVfem9vbSc7XG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5mb3Jtcy5mb3JtUHJvZmlsZS5lbGVtZW50cy5uYW1lO1xuY29uc3QgYWJvdXRJbnB1dCA9IGRvY3VtZW50LmZvcm1zLmZvcm1Qcm9maWxlLmVsZW1lbnRzLmFib3V0O1xuY29uc3QgdGVtcGxhdGVTZWxlY3RvciA9ICcjZ2FsbGVyeV9faXRlbSc7XG5jb25zdCBwcm9maWxlU3BhbkFycmF5ID0ge1xuICAgIG5hbWU6ICcudGV4dF9fbmFtZScsXG4gICAgYWJvdXQ6ICcudGV4dF9fYWJvdXQnLFxufTtcblxuY29uc3Qgb3BlblByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRleHRfX2VkaXQnKTtcbmNvbnN0IG9wZW5JbWdBZGRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b3BfX3BsdXMtYm94Jyk7XG4vL3NldHRpbmdzXG5jb25zdCBzZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiAnLmZpZWxkc2V0X19pbnB1dCcsXG4gICAgYnV0dG9uU2VsZWN0b3I6ICcuZmllbGRzZXRfX2J1dHRvbicsXG4gICAgYnV0dG9uRGlzYWJsZTogJ2ZpZWxkc2V0X19idXR0b25fZGlzYWJsZWQnLFxuICAgIGlucHV0RXJyb3JDbGFzczogJ2ZpZWxkc2V0X19pbnB1dF9lcnJvcicsXG4gICAgc3BhbkVycm9yQ2xhc3M6ICdmaWVsZHNldF9fZXJyb3ItbWVzc2FnZS1hY3RpdmUnLFxufTtcbmxldCB1c2VySWQ7XG5sZXQgc2VjdGlvbk5ldyA9ICcnO1xuZXhwb3J0IHtcbiAgICBnYWxsZXJ5V3JhcCxcbiAgICBhZGRDYXJkUG9wdXAsXG4gICAgcHJvZmlsZVBvcHVwLFxuICAgIG9wZW5JbWdWaWV3LFxuICAgIG5hbWVJbnB1dCxcbiAgICBhYm91dElucHV0LFxuICAgIHRlbXBsYXRlU2VsZWN0b3IsXG4gICAgcHJvZmlsZVNwYW5BcnJheSxcbiAgICBvcGVuUHJvZmlsZUVkaXRCdXR0b24sXG4gICAgb3BlbkltZ0FkZFBvcHVwLFxuICAgIHNldHRpbmdzLFxuICAgIHVzZXJJZCxcbiAgICBzZWN0aW9uTmV3LFxufTtcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkXCI7XHJcbmltcG9ydCB7IEZvcm1WYWxpZGF0b3IgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yXCI7XHJcbmltcG9ydCB7IFBvcHVwV2l0aEltYWdlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2VcIjtcclxuaW1wb3J0IHsgUG9wdXBXaXRoRm9ybSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm1cIjtcclxuaW1wb3J0IFBvcHVwV2l0aHN1Ym1pdCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXRcIjtcclxuaW1wb3J0IHsgU2VjdGlvbiB9IGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb25cIjtcclxuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mb1wiO1xyXG5pbXBvcnQgeyBhcGkgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGlcIjtcclxuaW1wb3J0IHtcclxuICBnYWxsZXJ5V3JhcCxcclxuICBhZGRDYXJkUG9wdXAsXHJcbiAgcHJvZmlsZVBvcHVwLFxyXG4gIG9wZW5JbWdWaWV3LFxyXG4gIHRlbXBsYXRlU2VsZWN0b3IsXHJcbiAgcHJvZmlsZVNwYW5BcnJheSxcclxuICBvcGVuUHJvZmlsZUVkaXRCdXR0b24sXHJcbiAgb3BlbkltZ0FkZFBvcHVwLFxyXG4gIHNldHRpbmdzLFxyXG4gIG5hbWVJbnB1dCxcclxuICBhYm91dElucHV0LFxyXG59IGZyb20gXCIuLi91dGlsaXRpZXMvY29uc3RhbnRzXCI7XHJcblxyXG5sZXQgdXNlcklkO1xyXG5jb25zdCBjb25maXJtTW9kYWwgPSBuZXcgUG9wdXBXaXRoc3VibWl0KFwiLnBvcHVwX3R5cGVfY2FyZC1kZWxldGVcIik7XHJcbmNvbmZpcm1Nb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5jb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oKGRhdGEpID0+IHtcclxuICByZW5kZXJDYXJkKGRhdGEpO1xyXG59LCBnYWxsZXJ5V3JhcCk7XHJcblxyXG5jb25zdCByZW5kZXJDYXJkID0gKGRhdGEpID0+IHtcclxuICBzZWN0aW9uLmFkZEl0ZW0oY3JlYXRlQ2FyZChkYXRhKSk7XHJcbn07XHJcbi8vZnVuY3Rpb25zLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhwcm9maWxlU3BhbkFycmF5KTtcclxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0Q2FyZHMoKV0pXHJcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNEYXRhXSkgPT4ge1xyXG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICBuYW1lSW5wdXQ6IHVzZXJEYXRhLm5hbWUsXHJcbiAgICAgIGFib3V0SW5wdXQ6IHVzZXJEYXRhLmFib3V0LFxyXG4gICAgfSk7XHJcbiAgICBzZWN0aW9uLnJlbmRlckluaXRpYWxJdGVtcyhjYXJkc0RhdGEpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuY29uc3Qgc3VibWl0UHJvZmlsZUZvcm1JbnB1dHMgPSAoZGF0YSkgPT4ge1xyXG4gIGFwaVxyXG4gICAgLnNldFVzZXJJbmZvKHsgbmFtZTogZGF0YS5uYW1lLCBhYm91dDogZGF0YS5hYm91dCB9KVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcclxuICAgICAgICBuYW1lSW5wdXQ6IGRhdGEubmFtZSxcclxuICAgICAgICBhYm91dElucHV0OiBkYXRhLmFib3V0LFxyXG4gICAgICB9KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyLCBcInNvbWV0aGluZyB3ZW50IHdyb25nLi4gPS9cIikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVGb3JtLmNsb3NlKCk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGRhdGEsXHJcbiAgICB1c2VySWQsXHJcbiAgICB0ZW1wbGF0ZVNlbGVjdG9yLFxyXG4gICAgKG5hbWUsIGxpbmspID0+IHtcclxuICAgICAgcG9wdXBXaXRoSW1hZ2Uub3BlbihuYW1lLCBsaW5rKTtcclxuICAgIH0sXHJcbiAgICAoaWQpID0+IHtcclxuICAgICAgY29uc3QgaXNMaWtlZCA9IGNhcmQuaXNMaWtlZCgpO1xyXG5cclxuICAgICAgaWYgKCFpc0xpa2VkKSB7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAubGlrZUNhcmQoaWQpXHJcbiAgICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmQuc2V0TGlrZXMocmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgY2FyZC5hZGRMaWtlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKCkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFwaS5kaXNsaWtlQ2FyZChpZCkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICBjYXJkLnNldExpa2VzKHJlcy5saWtlcyk7XHJcbiAgICAgICAgICBjYXJkLnJlbW92ZUxpa2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIChjYXJkSWQpID0+IHtcclxuICAgICAgY29uZmlybU1vZGFsLm9wZW4oKTtcclxuICAgICAgY29uZmlybU1vZGFsLnNldEFjdGlvbigoKSA9PlxyXG4gICAgICAgIGFwaS5kZWxldGVDYXJkKGNhcmRJZCkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIjExMTFcIiwgcmVzKTtcclxuICAgICAgICAgIGNhcmQucmVtb3ZlQ2FyZCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgKTtcclxuICByZXR1cm4gY2FyZC5jcmVhdGVDYXJkKCk7XHJcbn07XHJcblxyXG5jb25zdCBhZGRDYXJkRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKGFkZENhcmRQb3B1cCwgKGRhdGEpID0+IHtcclxuICBhcGlcclxuICAgIC5hZGRDYXJkKHsgbmFtZTogZGF0YS50aXRsZSwgbGluazogZGF0YS5saW5rIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIHJlbmRlckNhcmQocmVzLCBnYWxsZXJ5V3JhcCk7XHJcbiAgICAgIGFkZENhcmRGb3JtLmNsb3NlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxufSk7XHJcblxyXG5jb25zdCBmb3JtVmFsaWRhdG9ycyA9IHsgZm9ybUltZzogXCJmb3JtSW1nXCIsIGZvcm1Qcm9maWxlOiBcImZvcm1Qcm9maWxlXCIgfTtcclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtXCIpKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBmb3JtRWwpO1xyXG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWwuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcclxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvcjtcclxuICAgIHZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgfSk7XHJcbn07XHJcbmNvbnN0IHJlc2V0QW5kT3BlbkltZ0FkZEZvcm0gPSAoKSA9PiB7XHJcbiAgZm9ybVZhbGlkYXRvcnNbZm9ybUltZy5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpXS5yZXNldFZhbGlkYXRpb24oKTtcclxuICBhZGRDYXJkRm9ybS5vcGVuKCk7XHJcbn07XHJcbmNvbnN0IGhhbmRsZVByb2ZpbGVGb3JtSW5wdXRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IHsgbmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgbmFtZUlucHV0LnZhbHVlID0gbmFtZTtcclxuICBhYm91dElucHV0LnZhbHVlID0gYWJvdXQ7XHJcbn07XHJcblxyXG5jb25zdCByZXNldEFuZE9wZW5Qcm9maWxlRm9ybSA9ICgpID0+IHtcclxuICBmb3JtVmFsaWRhdG9yc1tmb3JtUHJvZmlsZS5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpXS5yZXNldFZhbGlkYXRpb24oKTtcclxuICBjb25zdCBwcm9maWxlRGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgaGFuZGxlUHJvZmlsZUZvcm1JbnB1dHMocHJvZmlsZURhdGEpO1xyXG4gIHByb2ZpbGVGb3JtLm9wZW4oKTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbi8vY2xhc3Nlcy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuY29uc3QgcG9wdXBXaXRoSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2Uob3BlbkltZ1ZpZXcpO1xyXG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgcHJvZmlsZUZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShwcm9maWxlUG9wdXAsIHN1Ym1pdFByb2ZpbGVGb3JtSW5wdXRzKTtcclxucHJvZmlsZUZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmFkZENhcmRGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vL2xpc3RlbmVycy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5vcGVuSW1nQWRkUG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHJlc2V0QW5kT3BlbkltZ0FkZEZvcm0oKSk7XHJcblxyXG5vcGVuUHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICByZXNldEFuZE9wZW5Qcm9maWxlRm9ybSgpO1xyXG59KTtcclxuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cFwiO1xyXG5jbGFzcyBQb3B1cFdpdGhTdWJtaXQgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICBcclxuICBzZXRBY3Rpb24oYWN0aW9uKSB7XHJcbiAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gIH1cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aFN1Ym1pdDtcclxuIiwiZXhwb3J0IGNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICAvLyB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJJbml0aWFsSXRlbXMoaXRlbXMpIHtcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRJdGVtKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgIHRoaXMuX3VzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihkYXRhLm5hbWUpO1xuICAgIHRoaXMuX3VzZXJBYm91dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZGF0YS5hYm91dCk7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudCxcbiAgICB9O1xuICB9XG4gIHNldFVzZXJJbmZvKHsgbmFtZUlucHV0LCBhYm91dElucHV0IH0pIHtcbiAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5hbWVJbnB1dDtcbiAgICB0aGlzLl91c2VyQWJvdXQudGV4dENvbnRlbnQgPSBhYm91dElucHV0O1xuICB9XG59XG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwXCI7XG5leHBvcnQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIG9wZW4obmFtZSwgbGluaykge1xuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1nXCIpO1xuICAgIHRoaXMuX2NhcHRpb24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jYXB0aW9uXCIpO1xuXG4gICAgKHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lKSxcbiAgICAgICh0aGlzLl9pbWFnZS5zcmMgPSBsaW5rKSxcbiAgICAgICh0aGlzLl9pbWFnZS5hbHQgPSBgUGhvdG8gb2YgJHtuYW1lfWApO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJ1c2VySWQiLCJzZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZUxpa2VCdXR0b24iLCJoYW5kbGVEZWxldGVDYXJkIiwidGhpcyIsIl9jYXJkRWxlbWVudCIsInJlbW92ZSIsIl9uYW1lIiwibmFtZSIsIl91c2VySWQiLCJfbGluayIsImxpbmsiLCJfbGlrZXMiLCJsaWtlcyIsIl9vd25lcklkIiwib3duZXIiLCJfaWQiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZUxpa2VCdXR0b24iLCJfYWx0IiwiX3RlbXBsYXRlRWxlbWVudCIsImdldE93bmVyIiwiY29uc29sZSIsImxvZyIsIl9vd25lciIsImlzTGlrZWQiLCJzb21lIiwibGlrZSIsIl9oYW5kbGVEZWxldGUiLCJjYXJkSWQiLCJnZXRJZCIsIl9zZXRFdmVudExpc3RlbmVycyIsIl9kZWxldGVDYXJkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9saWtlQ2FyZCIsIl9nYWxsZXJ5SW1nIiwiYWRkTGlrZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZUxpa2UiLCJzZXRMaWtlcyIsIm5ld0xpa2VzIiwibGlrZXNBbW91bnQiLCJsZW5ndGgiLCJfbGlrZXNDb3VudGVyIiwidGV4dENvbnRlbnQiLCJjcmVhdGVDYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9nYWxsZXJ5VGV4dCIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJzZXR0aW5ncyIsImZvcm1FbGVtZW50IiwiX2hpZGVBbGxFcnJvcnMiLCJfZm9ybUVsZW1lbnQiLCJyZXNldCIsIl9kaXNhYmxlQnV0dG9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJfYWxsSW5wdXRzIiwiZm9yRWFjaCIsImlucHV0RWwiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiX3RvZ2dsZUJ1dHRvbiIsImlucHV0IiwiX2hpZGVJbnB1dEVycm9yIiwiYnV0dG9uRGlzYWJsZSIsIl9zZXR0aW5ncyIsIl9idXR0b25FbCIsImRpc2FibGVkIiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvckNsYXNzIiwic3BhbkVycm9yQ2xhc3MiLCJfZXJyb3JEeW5hbWljU3BhbiIsImlkIiwiaW5wdXRzIiwiZXZlcnkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsImJ1dHRvblNlbGVjdG9yIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwidGFyZ2V0IiwiY29udGFpbnMiLCJjbG9zZSIsImtleSIsIl9wb3B1cCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlT3ZlcmxheSIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtIiwic3VwZXIiLCJfaGFuZGxlRm9ybSIsIl9mb3JtIiwiX2lucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsIl92YWx1ZXMiLCJfa2V5IiwiX3ZhbHVlIiwidmFsdWUiLCJfdmFsdWVzRnJvbUZvcm0iLCJzZXRJbnB1dFZhbHVlcyIsImN1c3RvbUZldGNoIiwidXJsIiwiaGVhZGVycyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXNUZXh0IiwiY2F0Y2giLCJlcnIiLCJhcGkiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImdldENhcmRzIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGRDYXJkIiwiZGVsZXRlQ2FyZCIsImRpc2xpa2VDYXJkIiwibGlrZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiZ2FsbGVyeVdyYXAiLCJuYW1lSW5wdXQiLCJmb3JtcyIsImZvcm1Qcm9maWxlIiwiZWxlbWVudHMiLCJhYm91dElucHV0Iiwib3BlblByb2ZpbGVFZGl0QnV0dG9uIiwib3BlbkltZ0FkZFBvcHVwIiwiY29uZmlybU1vZGFsIiwic2V0QWN0aW9uIiwiYWN0aW9uIiwiX3N1Ym1pdEhhbmRsZXIiLCJzZWN0aW9uIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJbml0aWFsSXRlbXMiLCJpdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwicHJlcGVuZCIsInJlbmRlckNhcmQiLCJ1c2VySW5mbyIsIl91c2VyTmFtZSIsIl91c2VyQWJvdXQiLCJhbGwiLCJ1c2VyRGF0YSIsImNhcmRzRGF0YSIsImNhcmQiLCJwb3B1cFdpdGhJbWFnZSIsInJlbW92ZUNhcmQiLCJhZGRDYXJkRm9ybSIsInRpdGxlIiwiZm9ybVZhbGlkYXRvcnMiLCJmb3JtSW1nIiwiZm9ybUVsIiwidmFsaWRhdG9yIiwiZm9ybU5hbWUiLCJnZXRBdHRyaWJ1dGUiLCJlbmFibGVWYWxpZGF0aW9uIiwiX2ltYWdlIiwiX2NhcHRpb24iLCJwcm9maWxlRm9ybSIsImZpbmFsbHkiLCJyZXNldFZhbGlkYXRpb24iLCJoYW5kbGVQcm9maWxlRm9ybUlucHV0cyJdLCJzb3VyY2VSb290IjoiIn0=