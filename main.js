!function(){"use strict";const e=".gallery",t=document.forms.formProfile.elements.name,s=document.forms.formProfile.elements.about,r=document.querySelector(".text__edit"),i=document.querySelector(".top__plus-box"),n={inputSelector:".fieldset__input",buttonSelector:".fieldset__button",buttonDisable:"fieldset__button_disabled",inputErrorClass:"fieldset__input_error",spanErrorClass:"fieldset__error-message-active"};class o{constructor(e,t,s,r,i,n){this._name=e.name,this._userId=t,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._id=e._id,this._handleCardClick=r,this._handleLikeButton=i,this._handleDeleteCard=n,this._alt="Photo of ".concat(e.name),this._templateElement=s}_isMyCard(){this._ownerId!==this._userId&&(this._deleteCard.style.display="none")}getOwner(){console.log(this._owner)}isLiked(){return this._likes.some((e=>e._id==this._userId))}getId(){return this._id}removeCard(){this._cardElement.remove()}_setEventListeners(){this._deleteCard.addEventListener("click",(()=>{this._handleDeleteCard(this._id)})),this._likeCard.addEventListener("click",(()=>this._handleLikeButton(this._id))),this._galleryImg.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))}addLike(){this._likeCard.classList.add("button_liked")}removeLike(){this._likeCard.classList.remove("button_liked")}setLikes(e){this._likes=e,this.likesAmount=this._likes.length,this._likesCounter.textContent=this.likesAmount}createCard(){return this._cardElement=document.querySelector(this._templateElement).content.querySelector(".gallery__item").cloneNode(!0),this._galleryImg=this._cardElement.querySelector(".gallery__img"),this._galleryText=this._cardElement.querySelector(".desc__text"),this._deleteCard=this._cardElement.querySelector(".gallery__bin"),this._likeCard=this._cardElement.querySelector(".like__button"),this._likesCounter=this._cardElement.querySelector(".like__counter"),this._galleryText.textContent=this._name,this._galleryImg.src=this._link,this._galleryImg.alt=this._alt,this.setLikes(this._likes),this._isMyCard(),this._setEventListeners(),this.isLiked()?this.addLike():this.removeLike(),this._cardElement}}function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor(e,t){a(this,"resetValidation",(()=>{this._hideAllErrors(),this._formElement.reset(),this._disableButton()})),a(this,"enableValidation",(()=>{this._formElement.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()})),a(this,"_setEventListeners",(()=>{this._allInputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton(this._allInputs)}))}))})),a(this,"_hideAllErrors",(()=>{this._allInputs.forEach((e=>{this._hideInputError(e)}))})),a(this,"_disableButton",(()=>{const{buttonDisable:e}=this._settings;this._buttonEl.classList.add(e),this._buttonEl.disabled=!0})),a(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,spanErrorClass:r}=this._settings;this._errorDynamicSpan=this._formElement.querySelector(".fieldset__error-type-".concat(e.id)),e.classList.add(s),this._errorDynamicSpan.textContent=t,this._errorDynamicSpan.classList.add(r)})),a(this,"_hideInputError",(e=>{const{inputErrorClass:t,spanErrorClass:s}=this._settings;this._errorDynamicSpan=this._formElement.querySelector(".fieldset__error-type-".concat(e.id)),e.classList.remove(t),this._errorDynamicSpan.classList.remove(s),this._errorDynamicSpan.textContent=""})),a(this,"_toggleButton",(e=>{const{buttonDisable:t}=this._settings;e.every((e=>e.validity.valid))?(this._buttonEl.classList.remove(t),this._buttonEl.disabled=!1):this._disableButton()})),a(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),this._settings=e,this._formElement=t,this._allInputs=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonEl=this._formElement.querySelector(this._settings.buttonSelector)}}function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class _{constructor(e){h(this,"_handleOverlay",(e=>{e.target.classList.contains("popup")&&this.close()})),h(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",this._handleOverlay),this._popup.querySelector(".popup__close").addEventListener("mousedown",(()=>this.close()))}}class d extends _{constructor(e,t){super(e),this._handleForm=t,this._form=this._popup.querySelector(".form"),this._inputs=Array.from(this._form.querySelectorAll(".fieldset__input"))}_getInputValues(){return this._values={},this._inputs.forEach((e=>{this._key=e.name,this._value=e.value,this._values[this._key]=this._value})),this._values}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._valuesFromForm=this._getInputValues(),this._handleForm(this._valuesFromForm),super.close()}))}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._form.reset()}}const c=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject(e.statusText))).catch((e=>{console.log(e)})),u=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}getCards(){return c(this._baseUrl+"/cards",{headers:this._headers})}getUserInfo(){return c(this._baseUrl+"/users/me",{headers:this._headers})}setUserInfo(e){let{name:t,about:s}=e;return c(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:s})})}addCard(e){let{name:t,link:s}=e;return c(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:s})})}deleteCard(e){return c("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}dislikeCard(e){return c("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"})}likeCard(e){return c("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"6efb715f-3f27-47aa-b11b-00d476bb80a2","Content-Type":"application/json"}});let m;const p=new class extends _{setAction(e){this._submitHandler=e}setEventListeners(){this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()})),super.setEventListeners()}}(".popup_type_card-delete");p.setEventListeners();const b=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}renderInitialItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}((e=>{E(e)}),e),E=e=>{b.addItem(y(e))},f=new class{constructor(e){this._userName=document.querySelector(e.name),this._userAbout=document.querySelector(e.about)}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent}}setUserInfo(e){let{nameInput:t,aboutInput:s}=e;this._userName.textContent=t,this._userAbout.textContent=s}}({name:".text__name",about:".text__about"});Promise.all([u.getUserInfo(),u.getCards()]).then((e=>{let[t,s]=e;m=t._id,f.setUserInfo({nameInput:t.name,aboutInput:t.about}),b.renderInitialItems(s)})).catch(console.log);const y=e=>{const t=new o(e,m,"#gallery__item",((e,t)=>{k.open(e,t)}),(e=>{t.isLiked()?u.dislikeCard(e).then((e=>{t.setLikes(e.likes),t.removeLike()})):u.likeCard(e).then((e=>{t.setLikes(e.likes),t.addLike()})).catch(console.log())}),(e=>{p.open(),p.setAction((()=>{u.deleteCard(e).then((e=>{t.removeCard(),p.close()})).catch(console,log("err"))}))}));return t.createCard()},g=new d(".popup_type_card",(t=>{u.addCard({name:t.title,link:t.link}).then((t=>{E(t,e),g.close()})).catch(console.log)})),v={formImg:"formImg",formProfile:"formProfile"};Array.from(document.querySelectorAll(".form")).forEach((e=>{const t=new l(n,e),s=e.getAttribute("name");v[s]=t,t.enableValidation()}));const k=new class extends _{open(e,t){this._image=this._popup.querySelector(".popup__img"),this._caption=this._popup.querySelector(".popup__caption"),this._caption.textContent=e,this._image.src=t,this._image.alt="Photo of ".concat(e),super.open()}}(".popup_type_zoom");k.setEventListeners();const L=new d(".popup_type_profile",(e=>{u.setUserInfo({name:e.name,about:e.about}).then((e=>{console.log(e),f.setUserInfo({nameInput:e.name,aboutInput:e.about})})).catch((e=>console.log(e,"something went wrong.. =/"))).finally((()=>{L.close()}))}));L.setEventListeners(),g.setEventListeners(),i.addEventListener("click",(()=>(v[formImg.getAttribute("name")].resetValidation(),void g.open()))),r.addEventListener("click",(()=>{v[formProfile.getAttribute("name")].resetValidation(),f.getUserInfo(),(()=>{const{name:e,about:r}=f.getUserInfo();t.value=e,s.value=r})(),L.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxpdGllcy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2FsbGVyeVdyYXAgPSAnLmdhbGxlcnknO1xuY29uc3QgYWRkQ2FyZFBvcHVwID0gJy5wb3B1cF90eXBlX2NhcmQnO1xuY29uc3QgcHJvZmlsZVBvcHVwID0gJy5wb3B1cF90eXBlX3Byb2ZpbGUnO1xuY29uc3Qgb3BlbkltZ1ZpZXcgPSAnLnBvcHVwX3R5cGVfem9vbSc7XG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5mb3Jtcy5mb3JtUHJvZmlsZS5lbGVtZW50cy5uYW1lO1xuY29uc3QgYWJvdXRJbnB1dCA9IGRvY3VtZW50LmZvcm1zLmZvcm1Qcm9maWxlLmVsZW1lbnRzLmFib3V0O1xuY29uc3QgdGVtcGxhdGVTZWxlY3RvciA9ICcjZ2FsbGVyeV9faXRlbSc7XG5jb25zdCBwcm9maWxlU3BhbkFycmF5ID0ge1xuICAgIG5hbWU6ICcudGV4dF9fbmFtZScsXG4gICAgYWJvdXQ6ICcudGV4dF9fYWJvdXQnLFxufTtcblxuY29uc3Qgb3BlblByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRleHRfX2VkaXQnKTtcbmNvbnN0IG9wZW5JbWdBZGRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b3BfX3BsdXMtYm94Jyk7XG4vL3NldHRpbmdzXG5jb25zdCBzZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiAnLmZpZWxkc2V0X19pbnB1dCcsXG4gICAgYnV0dG9uU2VsZWN0b3I6ICcuZmllbGRzZXRfX2J1dHRvbicsXG4gICAgYnV0dG9uRGlzYWJsZTogJ2ZpZWxkc2V0X19idXR0b25fZGlzYWJsZWQnLFxuICAgIGlucHV0RXJyb3JDbGFzczogJ2ZpZWxkc2V0X19pbnB1dF9lcnJvcicsXG4gICAgc3BhbkVycm9yQ2xhc3M6ICdmaWVsZHNldF9fZXJyb3ItbWVzc2FnZS1hY3RpdmUnLFxufTtcbmxldCB1c2VySWQ7XG5sZXQgc2VjdGlvbk5ldyA9ICcnO1xuZXhwb3J0IHtcbiAgICBnYWxsZXJ5V3JhcCxcbiAgICBhZGRDYXJkUG9wdXAsXG4gICAgcHJvZmlsZVBvcHVwLFxuICAgIG9wZW5JbWdWaWV3LFxuICAgIG5hbWVJbnB1dCxcbiAgICBhYm91dElucHV0LFxuICAgIHRlbXBsYXRlU2VsZWN0b3IsXG4gICAgcHJvZmlsZVNwYW5BcnJheSxcbiAgICBvcGVuUHJvZmlsZUVkaXRCdXR0b24sXG4gICAgb3BlbkltZ0FkZFBvcHVwLFxuICAgIHNldHRpbmdzLFxuICAgIHVzZXJJZCxcbiAgICBzZWN0aW9uTmV3LFxufTtcbiIsImltcG9ydCB7IHVzZXJJZCB9IGZyb20gXCIuLi91dGlsaXRpZXMvY29uc3RhbnRzXCI7XG5cbmV4cG9ydCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgZGF0YSxcbiAgICB1c2VySWQsXG4gICAgc2VsZWN0b3IsXG4gICAgaGFuZGxlQ2FyZENsaWNrLFxuICAgIGhhbmRsZUxpa2VCdXR0b24sXG4gICAgaGFuZGxlRGVsZXRlQ2FyZFxuICApIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbiA9IGhhbmRsZUxpa2VCdXR0b247XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XG4gICAgdGhpcy5fYWx0ID0gYFBob3RvIG9mICR7ZGF0YS5uYW1lfWA7XG4gICAgdGhpcy5fdGVtcGxhdGVFbGVtZW50ID0gc2VsZWN0b3I7XG4gIH1cbiAgX2lzTXlDYXJkKCkge1xuICAgIGlmICh0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cbiAgfVxuICBnZXRPd25lcigpIHtcbiAgICBjb25zb2xlLmxvZyh0aGlzLl9vd25lcik7XG4gIH1cbiAgaXNMaWtlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT0gdGhpcy5fdXNlcklkKTtcbiAgfVxuXG4gIGdldElkKCkge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuICByZW1vdmVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2RlbGV0ZUNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQodGhpcy5faWQpO1xuICAgIH0pO1xuICAgIHRoaXMuX2xpa2VDYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbih0aGlzLl9pZClcbiAgICApO1xuICAgIHRoaXMuX2dhbGxlcnlJbWcuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluaylcbiAgICApO1xuICB9XG4gIGFkZExpa2UoKSB7XG4gICAgdGhpcy5fbGlrZUNhcmQuY2xhc3NMaXN0LmFkZChcImJ1dHRvbl9saWtlZFwiKTtcbiAgfVxuICByZW1vdmVMaWtlKCkge1xuICAgIHRoaXMuX2xpa2VDYXJkLmNsYXNzTGlzdC5yZW1vdmUoXCJidXR0b25fbGlrZWRcIik7XG4gIH1cblxuICBzZXRMaWtlcyhuZXdMaWtlcykge1xuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXM7XG4gICAgdGhpcy5saWtlc0Ftb3VudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICB0aGlzLl9saWtlc0NvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLmxpa2VzQW1vdW50O1xuICB9XG5cbiAgY3JlYXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl90ZW1wbGF0ZUVsZW1lbnQpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2l0ZW1cIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICB0aGlzLl9nYWxsZXJ5SW1nID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pbWdcIik7XG4gICAgdGhpcy5fZ2FsbGVyeVRleHQgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmRlc2NfX3RleHRcIik7XG4gICAgdGhpcy5fZGVsZXRlQ2FyZCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fYmluXCIpO1xuICAgIHRoaXMuX2xpa2VDYXJkID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5saWtlX19idXR0b25cIik7XG4gICAgdGhpcy5fbGlrZXNDb3VudGVyID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5saWtlX19jb3VudGVyXCIpO1xuICAgIHRoaXMuX2dhbGxlcnlUZXh0LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9nYWxsZXJ5SW1nLnNyYyA9IHRoaXMuX2xpbms7XG5cbiAgICB0aGlzLl9nYWxsZXJ5SW1nLmFsdCA9IHRoaXMuX2FsdDtcbiAgICB0aGlzLnNldExpa2VzKHRoaXMuX2xpa2VzKTtcbiAgICB0aGlzLl9pc015Q2FyZCgpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XG4gICAgICB0aGlzLmFkZExpa2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdmVMaWtlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5fYWxsSW5wdXRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIHRoaXMuX2J1dHRvbkVsID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3NldHRpbmdzLmJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuICByZXNldFZhbGlkYXRpb24gPSAoKSA9PiB7XG4gICAgdGhpcy5faGlkZUFsbEVycm9ycygpO1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LnJlc2V0KCk7XG4gICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xuICB9O1xuICBlbmFibGVWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gZXZ0LnByZXZlbnREZWZhdWx0KCkpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH07XG4gIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLl9hbGxJbnB1dHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvbih0aGlzLl9hbGxJbnB1dHMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIF9oaWRlQWxsRXJyb3JzID0gKCkgPT4ge1xuICAgIHRoaXMuX2FsbElucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXQpO1xuICAgIH0pO1xuICB9O1xuICBfZGlzYWJsZUJ1dHRvbiA9ICgpID0+IHtcbiAgICBjb25zdCB7IGJ1dHRvbkRpc2FibGUgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIHRoaXMuX2J1dHRvbkVsLmNsYXNzTGlzdC5hZGQoYnV0dG9uRGlzYWJsZSk7XG4gICAgdGhpcy5fYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICB9O1xuICBfc2hvd0lucHV0RXJyb3IgPSAoaW5wdXRFbCwgZXJyb3JNZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIHNwYW5FcnJvckNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICB0aGlzLl9lcnJvckR5bmFtaWNTcGFuID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuZmllbGRzZXRfX2Vycm9yLXR5cGUtJHtpbnB1dEVsLmlkfWBcbiAgICApO1xuICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yRHluYW1pY1NwYW4udGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgdGhpcy5fZXJyb3JEeW5hbWljU3Bhbi5jbGFzc0xpc3QuYWRkKHNwYW5FcnJvckNsYXNzKTtcbiAgfTtcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWwpID0+IHtcbiAgICBjb25zdCB7IGlucHV0RXJyb3JDbGFzcywgc3BhbkVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIHRoaXMuX2Vycm9yRHluYW1pY1NwYW4gPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYC5maWVsZHNldF9fZXJyb3ItdHlwZS0ke2lucHV0RWwuaWR9YFxuICAgICk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3JEeW5hbWljU3Bhbi5jbGFzc0xpc3QucmVtb3ZlKHNwYW5FcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvckR5bmFtaWNTcGFuLnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcbiAgX3RvZ2dsZUJ1dHRvbiA9IChpbnB1dHMpID0+IHtcbiAgICBjb25zdCB7IGJ1dHRvbkRpc2FibGUgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIGNvbnN0IGlzSW5wdXRzVmFsaWQgPSBpbnB1dHMuZXZlcnkoKGlucHV0KSA9PiBpbnB1dC52YWxpZGl0eS52YWxpZCk7XG5cbiAgICBpZiAoaXNJbnB1dHNWYWxpZCkge1xuICAgICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShidXR0b25EaXNhYmxlKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oKTtcbiAgICB9XG4gIH07XG4gIF9jaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXRFbCkgPT4ge1xuICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xuICAgIH1cbiAgfTtcbn1cbiIsImV4cG9ydCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gIH1cbiAgX2hhbmRsZU92ZXJsYXkgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBcIikpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgX2hhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlblwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVPdmVybGF5KTtcbiAgICB0aGlzLl9wb3B1cFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwXCI7XG5leHBvcnQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybSkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm0gPSBoYW5kbGVGb3JtO1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XG4gICAgdGhpcy5faW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmllbGRzZXRfX2lucHV0XCIpKTtcbiAgfVxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgdGhpcy5fdmFsdWVzID0ge307XG5cbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2tleSA9IGlucHV0Lm5hbWU7XG4gICAgICB0aGlzLl92YWx1ZSA9IGlucHV0LnZhbHVlO1xuICAgICAgdGhpcy5fdmFsdWVzW3RoaXMuX2tleV0gPSB0aGlzLl92YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWVzO1xuICB9XG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5fdmFsdWVzRnJvbUZvcm0gPSB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybSh0aGlzLl92YWx1ZXNGcm9tRm9ybSk7XG4gICAgICBzdXBlci5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG4gIHNldElucHV0VmFsdWVzKGRhdGEpIHtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICB9XG59XG4iLCJjb25zdCBjdXN0b21GZXRjaCA9ICh1cmwsIGhlYWRlcnMpID0+IHtcclxuICByZXR1cm4gZmV0Y2godXJsLCBoZWFkZXJzKVxyXG4gICAgLnRoZW4oKHJlcykgPT4gKHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpKVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3RvcihzZXR0aW5ncykge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IHNldHRpbmdzLmJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gc2V0dGluZ3MuaGVhZGVycztcclxuICB9XHJcbiAgZ2V0Q2FyZHMoKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2godGhpcy5fYmFzZVVybCArIFwiL2NhcmRzXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaCh0aGlzLl9iYXNlVXJsICsgYC91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkc1wiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgZGlzbGlrZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGxpa2VDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtpZH1gLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCI2ZWZiNzE1Zi0zZjI3LTQ3YWEtYjExYi0wMGQ0NzZiYjgwYTJcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgeyBDYXJkIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZFwiO1xyXG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvclwiO1xyXG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlXCI7XHJcbmltcG9ydCB7IFBvcHVwV2l0aEZvcm0gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhzdWJtaXQgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0XCI7XHJcbmltcG9ydCB7IFNlY3Rpb24gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uXCI7XHJcbmltcG9ydCB7IFVzZXJJbmZvIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm9cIjtcclxuaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpXCI7XHJcbmltcG9ydCB7XHJcbiAgZ2FsbGVyeVdyYXAsXHJcbiAgYWRkQ2FyZFBvcHVwLFxyXG4gIHByb2ZpbGVQb3B1cCxcclxuICBvcGVuSW1nVmlldyxcclxuICB0ZW1wbGF0ZVNlbGVjdG9yLFxyXG4gIHByb2ZpbGVTcGFuQXJyYXksXHJcbiAgb3BlblByb2ZpbGVFZGl0QnV0dG9uLFxyXG4gIG9wZW5JbWdBZGRQb3B1cCxcclxuICBzZXR0aW5ncyxcclxuICBuYW1lSW5wdXQsXHJcbiAgYWJvdXRJbnB1dCxcclxufSBmcm9tIFwiLi4vdXRpbGl0aWVzL2NvbnN0YW50c1wiO1xyXG5cclxubGV0IHVzZXJJZDtcclxuY29uc3QgY29uZmlybU1vZGFsID0gbmV3IFBvcHVwV2l0aHN1Ym1pdChcIi5wb3B1cF90eXBlX2NhcmQtZGVsZXRlXCIpO1xyXG5jb25maXJtTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuY29uc3Qgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKChkYXRhKSA9PiB7XHJcbiAgcmVuZGVyQ2FyZChkYXRhKTtcclxufSwgZ2FsbGVyeVdyYXApO1xyXG5cclxuY29uc3QgcmVuZGVyQ2FyZCA9IChkYXRhKSA9PiB7XHJcbiAgc2VjdGlvbi5hZGRJdGVtKGNyZWF0ZUNhcmQoZGF0YSkpO1xyXG59O1xyXG4vL2Z1bmN0aW9ucy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8ocHJvZmlsZVNwYW5BcnJheSk7XHJcblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldENhcmRzKCldKVxyXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzRGF0YV0pID0+IHtcclxuICAgIHVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcclxuICAgICAgbmFtZUlucHV0OiB1c2VyRGF0YS5uYW1lLFxyXG4gICAgICBhYm91dElucHV0OiB1c2VyRGF0YS5hYm91dCxcclxuICAgIH0pO1xyXG4gICAgc2VjdGlvbi5yZW5kZXJJbml0aWFsSXRlbXMoY2FyZHNEYXRhKTtcclxuICB9KVxyXG4gIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbmNvbnN0IHN1Ym1pdFByb2ZpbGVGb3JtSW5wdXRzID0gKGRhdGEpID0+IHtcclxuICBhcGlcclxuICAgIC5zZXRVc2VySW5mbyh7IG5hbWU6IGRhdGEubmFtZSwgYWJvdXQ6IGRhdGEuYWJvdXQgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XHJcbiAgICAgICAgbmFtZUlucHV0OiBkYXRhLm5hbWUsXHJcbiAgICAgICAgYWJvdXRJbnB1dDogZGF0YS5hYm91dCxcclxuICAgICAgfSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVyciwgXCJzb21ldGhpbmcgd2VudCB3cm9uZy4uID0vXCIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBwcm9maWxlRm9ybS5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVDYXJkID0gKGRhdGEpID0+IHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICBkYXRhLFxyXG4gICAgdXNlcklkLFxyXG4gICAgdGVtcGxhdGVTZWxlY3RvcixcclxuICAgIChuYW1lLCBsaW5rKSA9PiB7XHJcbiAgICAgIHBvcHVwV2l0aEltYWdlLm9wZW4obmFtZSwgbGluayk7XHJcbiAgICB9LFxyXG4gICAgKGlkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzTGlrZWQgPSBjYXJkLmlzTGlrZWQoKTtcclxuXHJcbiAgICAgIGlmICghaXNMaWtlZCkge1xyXG4gICAgICAgIGFwaVxyXG4gICAgICAgICAgLmxpa2VDYXJkKGlkKVxyXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLnNldExpa2VzKHJlcy5saWtlcyk7XHJcbiAgICAgICAgICAgIGNhcmQuYWRkTGlrZSgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZygpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhcGkuZGlzbGlrZUNhcmQoaWQpLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgY2FyZC5zZXRMaWtlcyhyZXMubGlrZXMpO1xyXG4gICAgICAgICAgY2FyZC5yZW1vdmVMaWtlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICAoY2FyZElkKSA9PiB7XHJcbiAgICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XHJcblxyXG4gICAgICBjb25maXJtTW9kYWwuc2V0QWN0aW9uKCgpID0+IHtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC5kZWxldGVDYXJkKGNhcmRJZClcclxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XHJcbiAgICAgICAgICAgIGNvbmZpcm1Nb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLCBsb2coXCJlcnJcIikpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICApO1xyXG4gIHJldHVybiBjYXJkLmNyZWF0ZUNhcmQoKTtcclxufTtcclxuXHJcbmNvbnN0IGFkZENhcmRGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oYWRkQ2FyZFBvcHVwLCAoZGF0YSkgPT4ge1xyXG4gIGFwaVxyXG4gICAgLmFkZENhcmQoeyBuYW1lOiBkYXRhLnRpdGxlLCBsaW5rOiBkYXRhLmxpbmsgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgcmVuZGVyQ2FyZChyZXMsIGdhbGxlcnlXcmFwKTtcclxuICAgICAgYWRkQ2FyZEZvcm0uY2xvc2UoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG59KTtcclxuXHJcbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0geyBmb3JtSW1nOiBcImZvcm1JbWdcIiwgZm9ybVByb2ZpbGU6IFwiZm9ybVByb2ZpbGVcIiB9O1xyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKCkgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1cIikpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xyXG4gICAgY29uc3QgdmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGZvcm1FbCk7XHJcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbC5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpO1xyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yO1xyXG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuY29uc3QgcmVzZXRBbmRPcGVuSW1nQWRkRm9ybSA9ICgpID0+IHtcclxuICBmb3JtVmFsaWRhdG9yc1tmb3JtSW1nLmdldEF0dHJpYnV0ZShcIm5hbWVcIildLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGFkZENhcmRGb3JtLm9wZW4oKTtcclxufTtcclxuY29uc3QgaGFuZGxlUHJvZmlsZUZvcm1JbnB1dHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgeyBuYW1lLCBhYm91dCB9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBuYW1lSW5wdXQudmFsdWUgPSBuYW1lO1xyXG4gIGFib3V0SW5wdXQudmFsdWUgPSBhYm91dDtcclxufTtcclxuXHJcbmNvbnN0IHJlc2V0QW5kT3BlblByb2ZpbGVGb3JtID0gKCkgPT4ge1xyXG4gIGZvcm1WYWxpZGF0b3JzW2Zvcm1Qcm9maWxlLmdldEF0dHJpYnV0ZShcIm5hbWVcIildLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGNvbnN0IHByb2ZpbGVEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICBoYW5kbGVQcm9maWxlRm9ybUlucHV0cyhwcm9maWxlRGF0YSk7XHJcbiAgcHJvZmlsZUZvcm0ub3BlbigpO1xyXG59O1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuLy9jbGFzc2VzLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5jb25zdCBwb3B1cFdpdGhJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShvcGVuSW1nVmlldyk7XHJcbnBvcHVwV2l0aEltYWdlLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBwcm9maWxlRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKHByb2ZpbGVQb3B1cCwgc3VibWl0UHJvZmlsZUZvcm1JbnB1dHMpO1xyXG5wcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuYWRkQ2FyZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vbGlzdGVuZXJzLy8vLy8vLy8vL1xyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbm9wZW5JbWdBZGRQb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gcmVzZXRBbmRPcGVuSW1nQWRkRm9ybSgpKTtcclxuXHJcbm9wZW5Qcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIHJlc2V0QW5kT3BlblByb2ZpbGVGb3JtKCk7XHJcbn0pO1xyXG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwXCI7XHJcbmNsYXNzIFBvcHVwV2l0aFN1Ym1pdCBleHRlbmRzIFBvcHVwIHtcclxuICBzZXRBY3Rpb24oYWN0aW9uKSB7XHJcbiAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gIH1cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xyXG4gICAgfSk7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxufVxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhTdWJtaXQ7XHJcbiIsImV4cG9ydCBjbGFzcyBTZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICAgICAgLy8gdGhpcy5faXRlbXMgPSBpdGVtcztcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgcmVuZGVySW5pdGlhbEl0ZW1zKGl0ZW1zKSB7XG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWRkSXRlbShpdGVtKSB7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGl0ZW0pO1xuICAgIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICB0aGlzLl91c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZGF0YS5uYW1lKTtcbiAgICB0aGlzLl91c2VyQWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGRhdGEuYWJvdXQpO1xuICB9XG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCxcbiAgICAgIGFib3V0OiB0aGlzLl91c2VyQWJvdXQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgfVxuICBzZXRVc2VySW5mbyh7IG5hbWVJbnB1dCwgYWJvdXRJbnB1dCB9KSB7XG4gICAgdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQ7XG4gICAgdGhpcy5fdXNlckFib3V0LnRleHRDb250ZW50ID0gYWJvdXRJbnB1dDtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cFwiO1xuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBvcGVuKG5hbWUsIGxpbmspIHtcbiAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltZ1wiKTtcbiAgICB0aGlzLl9jYXB0aW9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FwdGlvblwiKTtcblxuICAgICh0aGlzLl9jYXB0aW9uLnRleHRDb250ZW50ID0gbmFtZSksXG4gICAgICAodGhpcy5faW1hZ2Uuc3JjID0gbGluayksXG4gICAgICAodGhpcy5faW1hZ2UuYWx0ID0gYFBob3RvIG9mICR7bmFtZX1gKTtcbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJnYWxsZXJ5V3JhcCIsIm5hbWVJbnB1dCIsImRvY3VtZW50IiwiZm9ybXMiLCJmb3JtUHJvZmlsZSIsImVsZW1lbnRzIiwibmFtZSIsImFib3V0SW5wdXQiLCJhYm91dCIsIm9wZW5Qcm9maWxlRWRpdEJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJvcGVuSW1nQWRkUG9wdXAiLCJzZXR0aW5ncyIsImlucHV0U2VsZWN0b3IiLCJidXR0b25TZWxlY3RvciIsImJ1dHRvbkRpc2FibGUiLCJpbnB1dEVycm9yQ2xhc3MiLCJzcGFuRXJyb3JDbGFzcyIsIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJ1c2VySWQiLCJzZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZUxpa2VCdXR0b24iLCJoYW5kbGVEZWxldGVDYXJkIiwidGhpcyIsIl9uYW1lIiwiX3VzZXJJZCIsIl9saW5rIiwibGluayIsIl9saWtlcyIsImxpa2VzIiwiX293bmVySWQiLCJvd25lciIsIl9pZCIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlTGlrZUJ1dHRvbiIsIl9oYW5kbGVEZWxldGVDYXJkIiwiX2FsdCIsIl90ZW1wbGF0ZUVsZW1lbnQiLCJfaXNNeUNhcmQiLCJfZGVsZXRlQ2FyZCIsInN0eWxlIiwiZGlzcGxheSIsImdldE93bmVyIiwiY29uc29sZSIsImxvZyIsIl9vd25lciIsImlzTGlrZWQiLCJzb21lIiwibGlrZSIsImdldElkIiwicmVtb3ZlQ2FyZCIsIl9jYXJkRWxlbWVudCIsInJlbW92ZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJfbGlrZUNhcmQiLCJfZ2FsbGVyeUltZyIsImFkZExpa2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmVMaWtlIiwic2V0TGlrZXMiLCJuZXdMaWtlcyIsImxpa2VzQW1vdW50IiwibGVuZ3RoIiwiX2xpa2VzQ291bnRlciIsInRleHRDb250ZW50IiwiY3JlYXRlQ2FyZCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZ2FsbGVyeVRleHQiLCJzcmMiLCJhbHQiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJfaGlkZUFsbEVycm9ycyIsIl9mb3JtRWxlbWVudCIsInJlc2V0IiwiX2Rpc2FibGVCdXR0b24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIl9hbGxJbnB1dHMiLCJmb3JFYWNoIiwiaW5wdXRFbCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfdG9nZ2xlQnV0dG9uIiwiaW5wdXQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2V0dGluZ3MiLCJfYnV0dG9uRWwiLCJkaXNhYmxlZCIsImVycm9yTWVzc2FnZSIsIl9lcnJvckR5bmFtaWNTcGFuIiwiaWQiLCJpbnB1dHMiLCJldmVyeSIsInZhbGlkaXR5IiwidmFsaWQiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJ0YXJnZXQiLCJjb250YWlucyIsImNsb3NlIiwia2V5IiwiX3BvcHVwIiwib3BlbiIsIl9oYW5kbGVFc2NDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIl9oYW5kbGVPdmVybGF5IiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm0iLCJzdXBlciIsIl9oYW5kbGVGb3JtIiwiX2Zvcm0iLCJfaW5wdXRzIiwiX2dldElucHV0VmFsdWVzIiwiX3ZhbHVlcyIsIl9rZXkiLCJfdmFsdWUiLCJ2YWx1ZSIsIl92YWx1ZXNGcm9tRm9ybSIsInNldElucHV0VmFsdWVzIiwiY3VzdG9tRmV0Y2giLCJ1cmwiLCJoZWFkZXJzIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1c1RleHQiLCJjYXRjaCIsImVyciIsImFwaSIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0Q2FyZHMiLCJnZXRVc2VySW5mbyIsInNldFVzZXJJbmZvIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGRDYXJkIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImRpc2xpa2VDYXJkIiwibGlrZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiY29uZmlybU1vZGFsIiwic2V0QWN0aW9uIiwiYWN0aW9uIiwiX3N1Ym1pdEhhbmRsZXIiLCJzZWN0aW9uIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJbml0aWFsSXRlbXMiLCJpdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwicHJlcGVuZCIsInJlbmRlckNhcmQiLCJ1c2VySW5mbyIsIl91c2VyTmFtZSIsIl91c2VyQWJvdXQiLCJhbGwiLCJ1c2VyRGF0YSIsImNhcmRzRGF0YSIsImNhcmQiLCJwb3B1cFdpdGhJbWFnZSIsImFkZENhcmRGb3JtIiwidGl0bGUiLCJmb3JtVmFsaWRhdG9ycyIsImZvcm1JbWciLCJmb3JtRWwiLCJ2YWxpZGF0b3IiLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZSIsImVuYWJsZVZhbGlkYXRpb24iLCJfaW1hZ2UiLCJfY2FwdGlvbiIsInByb2ZpbGVGb3JtIiwiZmluYWxseSIsInJlc2V0VmFsaWRhdGlvbiIsImhhbmRsZVByb2ZpbGVGb3JtSW5wdXRzIl0sInNvdXJjZVJvb3QiOiIifQ==